steps:
  # This step uses the gcloud command-line tool to build and push the image.
  # This is a more robust method than calling docker directly.
  - name: 'gcr.io/cloud-builders/gcloud'
    id: 'Build and Push Backend'
    args:
      - 'builds'
      - 'submit'
      - './backend'
      - '--tag=europe-west1-docker.pkg.dev/${PROJECT_ID}/peacock-backend-repo/peacock-backend-service:${COMMIT_SHA}'

# This specifies the final image that Cloud Run will use for deployment.
images:
  - 'europe-west1-docker.pkg.dev/${PROJECT_ID}/peacock-backend-repo/peacock-backend-service:${COMMIT_SHA}'

options:
  logging: CLOUD_LOGGING_ONLY
